# 窗帘控制 Home Assistant 自定义组件

这是一个用于Home Assistant的自定义组件，支持通过TCP连接控制DOOYA窗帘系统。

## 功能特性

- 🏠 支持多设备控制（最多10个窗帘设备）
- 🔍 自动设备发现
- 📍 实时位置反馈
- 🎛️ 完整的窗帘控制功能（开启、关闭、停止、位置设置）
- 🔧 硬件限位器精度补偿
- 🌐 TCP连接支持（通过N580串口转TCP设备）

## 支持的设备

基于DOOYA协议的窗帘控制器，通过RS485总线连接。

## 安装

1. 将此组件复制到Home Assistant的`custom_components`目录下
2. 重启Home Assistant
3. 通过集成页面添加"窗帘控制"组件

## 配置

### 基本配置
- **主机地址**: N580设备的IP地址
- **端口**: TCP端口（默认32）
- **设备发现**: 支持自动发现或手动添加设备

### 设备映射
组件支持预定义的设备名称映射，包括：
- 主卧室（纱帘/布帘）
- 客厅（纱帘/布帘）
- 儿童房（纱帘/布帘）
- 书房（纱帘/布帘）
- 老人房（纱帘/布帘）

## 通信协议

基于DOOYA窗帘控制协议：
- 起始标志：0x55
- 设备地址：2字节（大端序）
- 功能码：0x01（读取）/ 0x02（写入）
- 数据地址和数据值
- CRC16校验（小端序）

## 文件结构

```
curtain_control/
├── __init__.py          # 组件初始化
├── manifest.json        # 组件清单
├── config_flow.py       # 配置流程
├── coordinator.py       # TCP通信协调器
├── device_discovery.py  # 设备发现服务
├── cover.py            # 窗帘实体
├── const.py            # 常量定义
└── translations/       # 多语言支持
```

## 开发

### 协议分析
详细的协议分析和通信日志请参考：
- `DOOYA_Protocol.md` - DOOYA协议完整文档
- `Modbus_Analysis.md` - Modbus协议分析（用于排查）

### 贡献
欢迎提交问题报告和功能请求！

## 许可证

MIT License

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本的窗帘控制功能
- 自动设备发现
- 位置精度补偿 